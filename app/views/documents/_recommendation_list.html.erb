<%= render partial: "documents/exception_check_button", locals: { button_text: "Regenerate AI Exception Check" } %>
<div class="recommendation-list">
  <p class="text-wrap text-left text-sm mb-2r transition-opacity ease-in duration-700">This suggestion was generated by a Large Language Model and while highly reliable, should still be subjected to careful verification.</p>
  <div class="relative grid grid-cols-1 md:grid-cols-1 mb-4">
    <% exceptions = document.exceptions(false) %>
    <dl class="divide-y divide-gray-200 md:grid md:grid-cols-3 md:gap-0 sm:px-0">
      <dt class="text-sm/6 font-bold text-gray-900 text-left px-4 py-6 ">AI Exception Check</dt>
      <% if document.accessibility_recommendation_from_inferences.present? %>
        <dd class="mt-1 text-sm/6 text-gray-700 sm:col-span-2 sm:mt-0 text-left px-4 py-6 ">
          <%= document.accessibility_recommendation_from_inferences %>
        </dd>
      <% end %>
      <% exceptions.each do |exception| %>
        <% info = DocumentInference::INFERENCE_TYPES[exception.inference_type.to_sym] %>
        <dt class="text-sm/6 font-medium text-gray-900 text-left text-wrap px-4 py-6  <%= exception.inference_value.to_s.downcase == "true" ? "bg-green-100" : "" %>">
          <br>
          <span class="font-bold"><%= info[:label] %>:</span>
          <% if exception.inference_type == 'exception:is_archival' %>
            <%= exception.inference_value.to_s.downcase == "true" ? "Yes, but clearly mark as archived" : "No" %>
          <% else %>
            <%= exception.inference_value.to_s.downcase == "true" ? "Yes" : "No" %>
          <% end %>
          <a href="<%= info[:url] %>" target="_blank"><i class="fas fa-info-circle ml-1"></i><span class="hidden">See ADA Fact Sheet</span></a>
        </dt>
        <dd class="mt-1 text-sm/6 text-gray-700 sm:col-span-2 sm:mt-0 text-wrap text-left px-4 py-6  <%= exception.inference_value.to_s.downcase == "true" ? "bg-green-100" : "" %>"><%= exception.inference_reason %></dd>
      <% end %>
    </dl>
    <% if exceptions.present? && exceptions.first.inference_model_name.present? %>
      <div class="text-sm mt-4 lg:mt-0 lg:absolute lg:right-0 lg:bottom-[-3.25em]">Generated by <%= exceptions.first.inference_model_name %></div>
    <% end %>
  </div>
  <%= render partial: "documents/feedback", locals: { document_inferences: document.exceptions(false) } %>
</div>